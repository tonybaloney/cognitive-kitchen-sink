<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Azure Cognitive Services - Anomaly Detection</title>
    <link rel="stylesheet" href="/res/css/bulma.min.css">
    <link rel="stylesheet" href="/res/fa/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js"></script>
    <!-- and it's easy to individually load additional languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/python.min.js"></script>
    
  </head>
  <body>
  <section class="main-content columns is-fullheight">
    <aside class="menu column is-2 is-narrow-mobile is-fullheight section">
      <p class="menu-label">
        Decision APIs
      </p>
      <ul class="menu-list">
        <li><a href="anomaly.html">Anomaly Detector</a></li>
        <li><a href="personalizer.html">Personalizer</a></li>
      </ul>
      <p class="menu-label">
        Language APIs
      </p>
      <ul class="menu-list">
        <li><a class="has-text-grey-lighter">Language Understanding</a></li>
        <li><a class="has-text-grey-lighter">Q&amp;A Maker</a></li>
        <li><a href="text_analytics.html" class="is-active">Text Analytics</a></li>
        <li><a class="has-text-grey-lighter">Translator</a></li>
      </ul>
      <p class="menu-label">
          Speech APIs
      </p>
      <ul class="menu-list">
          <li><a class="has-text-grey-lighter">Speech to Text</a></li>
          <li><a class="has-text-grey-lighter">Text to Speech</a></li>
          <li><a class="has-text-grey-lighter">Speech Translation</a></li>
          <li><a class="has-text-grey-lighter">Speaker Recognition</a></li>
      </ul>
      <p class="menu-label">
      Vision APIs
      </p>
        <ul class="menu-list">
          <li><a class="has-text-grey-lighter">Computer Vision</a></li>
          <li><a class="has-text-grey-lighter">Custom Vision</a></li>
          <li><a class="has-text-grey-lighter">Face API</a></li>
        </ul>
        <p class="menu-label">
          <a href="https://github.com/tonybaloney/cognitive-kitchen-sink" alt="Source Code"><i class="fab fa-github fa-3x"></i></a>
        </p>
    </aside>
    <div class="container column is-10">
        <div class="section">
            <h1 class="title">
                Text Analytics
            </h1>

            <div class="columns">
              <div class="column">
                <p>
                    To aid in our research of Koala habitats, we've seen a dataset that captured which species of tree the koala were spotted in. 
                    This data was then given to the Atlas of Living Australia as a species index and the APNI data was returned. After pulling a text description of each tree species from Wikipedia,
                    this demonstration will parse the text description from Wikipedia and identify key phrases. These phrases can be grouped and indexed for further ML work.
                </p>
                <p>Select a plant species to see the information from Wikipedia and some key phrases:</p>

            <div class="field">
              <label class="label">Species</label>
              <div class="control">
                <div class="select">
                  <select id='species'>
                    <option value="Eucalyptus carnea">Eucalyptus carnea</option>
                    <option value="Eucalyptus microcorys">Eucalyptus microcorys</option>
                    <option value="Alphitonia excelsa">Alphitonia excelsa</option>
                    <option value="Melaleuca quinquenervia">Melaleuca quinquenervia</option>
                    <option value="Eucalyptus tereticornis">Eucalyptus tereticornis</option>
                    <option value="Eucalyptus siderophloia">Eucalyptus siderophloia</option>
                    <option value="Eucalyptus racemosa">Eucalyptus racemosa</option>
                    <option value="Corymbia trachyphloia">Corymbia trachyphloia</option>
                    <option value="Eucalyptus littoralis">Eucalyptus littoralis</option>
                    <option value="Eucalyptus seeana">Eucalyptus seeana</option>
                    <option value="Angophora">Angophora</option>
                    <option value="Angophora woodsiana">Angophora woodsiana</option>
                    <option value="Lophostemon suaveolens">Lophostemon suaveolens</option>
                    <option value="Eucalyptus propinqua">Eucalyptus propinqua</option>
                    <option value="Lophostemon confertus">Lophostemon confertus</option>
                    <option value="Eucalyptus trachyphloia">Eucalyptus trachyphloia</option>
                    <option value="Corymbia intermedia">Corymbia intermedia</option>
                    <option value="Eucalyptus tindaliae">Eucalyptus tindaliae</option>
                    <option value="Eucalyptus moluccana">Eucalyptus moluccana</option>
                    <option value="Corymbia citriodora">Corymbia citriodora</option>
                    <option value="Eucalyptus resinifera">Eucalyptus resinifera</option>
                    <option value="Eucalyptus">Eucalyptus</option>
                    <option value="Cinnamomum camphora">Cinnamomum camphora</option>
                    <option value="Eucalyptus robusta">Eucalyptus robusta</option>
                    <option value="Eucalyptus fibrosa">Eucalyptus fibrosa</option>
                    <option value="Eucalyptus maculata">Eucalyptus maculata</option>
                    <option value="Eucalyptus dunnii">Eucalyptus dunnii</option>
                    <option value="Grevillea robusta">Grevillea robusta</option>
                    <option value="Corymbia Callistemon">Corymbia Callistemon</option>
                    <option value="Corymbia torelliana ">Corymbia torelliana </option>
                    <option value="Eucalyptus grandis">Eucalyptus grandis</option>
                    <option value="Eucalyptus curtisii">Eucalyptus curtisii</option>
                    <option value="Corymbia maculata">Corymbia maculata</option>
                    <option value="Eucalyptus crebra">Eucalyptus crebra</option>
                    <option value="Angophora leiocarpa">Angophora leiocarpa</option>
                    <option value="Eucalyptus acmeniodes">Eucalyptus acmeniodes</option>
                    <option value="Corymbia henryi">Corymbia henryi</option>
                    <option value="Eucalyptus melanophloia">Eucalyptus melanophloia</option>
                    <option value="Corymbia tessellaris">Corymbia tessellaris</option>
                    <option value="Eucalyptus major">Eucalyptus major</option>
                    <option value="Casuarina glauca">Casuarina glauca</option>
                    <option value="Acacia concurrens">Acacia concurrens</option>
                    <option value="Eucalyptus eugenioides">Eucalyptus eugenioides</option>
                    <option value="Ficus sp.">Ficus sp.</option>
                    <option value="Glochidion ferdinandi">Glochidion ferdinandi</option>
                    <option value="Ficus benjamina">Ficus benjamina</option>
                    <option value="Ficus watkinsiana">Ficus watkinsiana</option>
                    <option value="Ficus macrophylla">Ficus macrophylla</option>
                    <option value="Melaleuca quinquenervia">Melaleuca quinquenervia</option>
                    <option value="Lophostemon">Lophostemon</option>
                    <option value="Eucalyptus pilularis">Eucalyptus pilularis</option>
                    <option value="Eucalyptus intermedia">Eucalyptus intermedia</option>
                    <option value="Melaleuca leucadendra">Melaleuca leucadendra</option>
                    <option value="Jacaranda">Jacaranda</option>
                    <option value="Eucalyptus punctata">Eucalyptus punctata</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="control">
              <button id="submit-button" class="button is-primary" onclick="verify()">Submit</button>
            </div>
            </div>
              <div class="column is-one-third"><figure class="image is-4by3">
                <img src="/res/img/Eucalyptus_microcorys.jpg" alt="Tree (Eucalyptus microcorys).">
              </figure></div>
            </div>
            <br/>
            <article id="message-box" class="message" style="display: none;">
              <div class="message-header">
                <p>Result</p>
              </div>
              <div id="message-text" class="message-body"></div>
            </article>
            <p>
              <i>The <a href="https://github.com/tonybaloney/cognitive-kitchen-sink/blob/main/api/TextAnalytics/__init__.py">Source Code</a> is open source and licensed under MIT. 
                <a href="https://www.ala.org.au/terms-of-use/">Data</a> from the Atlas of Living Australia, distributed with attribution under <a href="https://creativecommons.org/licenses/by/3.0/au/deed.en">Attribution 3.0 Australia (CC BY 3.0 AU)</a>. </i>
            </p>

          </div>
          <div class="section">
              <h2 class="title">Azure Functions Source Code</h2>
              <pre><code class="language-python">
import os
from azure.core.credentials import AzureKeyCredential
from azure.ai.textanalytics import TextAnalyticsClient
import azure.functions as func
import json
from ..utils import debuggable


@debuggable()
def main(req: func.HttpRequest) -> func.HttpResponse: 
    species = req.params['species']
    with open('data/plants.json') as plants_index:
        plants = json.load(plants_index)

    if species not in plants:
        return func.HttpResponse(
            "Plant not recognized",
            status_code=400
        ) 

    plant_info = os.path.join('data', 'apni', plants[species]['id'] + '.txt')
    if not os.path.exists(plant_info):
        return func.HttpResponse(
            "No information on this plant",
            status_code=400
        )

    with open(plant_info) as p:
        plant_description = p.read()

    endpoint = os.environ["TEXT_ANALYTICS_ENDPOINT"]
    key = os.environ["TEXT_ANALYTICS_KEY"]

    text_analytics_client = TextAnalyticsClient(endpoint=endpoint, credential=AzureKeyCredential(key))

    articles = [plant_description]
    results = []
    result = text_analytics_client.extract_key_phrases(articles)
    for _, doc in enumerate(result):
        if not doc.is_error:
            results.extend(doc.key_phrases)

    
    return func.HttpResponse(
            json.dumps({"text": plant_description, "key_phrases": results, "link": "https://bie.ala.org.au/species/https://id.biodiversity.org.au/node/apni/{0}#".format(plants[species]['id'])}),
            status_code=200
        ) 
              </code></pre>
              </div>
          </div>
            <script>
              function verify() {
                document.getElementById("message-box").style.display = 'none';
                var species = document.getElementById("species").value;

                var xhr = new XMLHttpRequest();
                xhr.open(
                  "GET",
                  "https://white-pebble-0101a6a10.azurestaticapps.net/api/TextAnalytics?species="+species,
                  true
                );
                xhr.send();
                document.getElementById('submit-button').classList.add('is-loading');
                xhr.onload = function () {
                  document.getElementById('submit-button').classList.remove('is-loading');
                  document.getElementById("message-box").style.display = 'block';
                  document.getElementById("message-box").className = 'message';

                  if (this.status === 500){
                    document.getElementById('message-box').classList.add('is-danger');
                    document.getElementById("message-text").innerText = "Error with data";
                  } else if (this.status == 400){
                    document.getElementById('message-box').classList.add('is-warning');
                    document.getElementById("message-text").innerText = this.responseText;
                  } else {
                    document.getElementById('message-box').classList.add('is-success');
                    var result = JSON.parse(this.responseText);
                    var t = result.text;
                    for (var i = 0 ; i < result.key_phrases.length ; i ++){
                      t = t.replaceAll(result.key_phrases[i], `%^%${result.key_phrases[i]}%_%`);
                    }
                    t = t.replaceAll("%^%", `<span class="tag is-primary">`);
                    t = t.replaceAll("%_%", `</span>`);
                    t += `<br/><a class="button" href="${result.link}">More Information</a>`
                    document.getElementById("message-text").innerHTML = t;
                  }
                };
              }
            </script>
            <script>hljs.highlightAll();</script>
    </div>
    </div>
  </section>
  <footer class="footer">
    <div class="content has-text-centered">
      <p>
        Site built by <a href="https://github.com/tonybaloney">Anthony Shaw</a>. The source code is licensed
        <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.
      </p>
    </div>
  </footer>
  </body>
</html>